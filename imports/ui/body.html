<body>
	<div class="page-header container" style="background: lightgrey">
		  <h1>Codemap</h1>
			<p>User: {{> loginButtons}}</p>
        <p> using codeSystems: {{#each codesystems}}{{codesystem}}, {{/each}}</p>
  </div>
	{{#if currentUser}}
		<div class="container">
      {{> upload}}
      <br/>
			{{> buttons}}
      {{> export}}
		</div>
		<div class="container-fluid">
  		<hr/>
  		{{> bigtable}}
		</div>
	{{/if}}
</body>

<!-- HERE BE TEMPLATES -->

<template name='upload'>
  <div class="container">
    <h4>Step 1: Upload 2-column CSV with row headers:  "Source_Code" and "Source_Desc"</h4>
    {{#unless uploading}}
      <form class='upload' method="POST" enctype='multipart/form-data'>
        <input type='file' name="uploadCSV">
      </form>
    {{else}}
      <p><i class = 'fa fa-spin fa-refresh'></i> Uploading files...</p>
    {{/unless}}
  </div>
</template>


<template name="bigtable">
  <div>
	  <table class="table table-hover table-condensed">
    <thead>
      <tr>
        <th>
            <button class='btn allCodeSearch'>Search Codes</button>
            <button class='btn allDescSearch btn-primary'>Search Descriptions</button><br />
            Source Codes
        </th>
        <th class="col-12">Saved Concepts</th>
        <th>del</th>  
        <th> Search Stuff </th>     
      </tr>
    </thead>
    <tbody>
	    {{#each codes}}
	      <tr class = 'coderow'>
	        <td class="col-12">{{Source_Code}}: {{Source_Desc}}</td>
          <td class="col-12" style="width: 400px">
              <div style="overflow-x:auto">
                  {{#each cuis}}
                    {{searchCUI}}: {{Cname}} <br />
                  {{/each}}
              </div>
          </td>
          <td>
              <button class='btn btn-warning removeButton'>X</button>
          </td>  
          <td class="col-12 bg-info">
            <select class="resultSelector" id="{{_id}}resultSelect" style="width: 400px">
            {{#each results}}
              <option value = '{{ui}}'>{{ui}}: {{name}}</option>
            {{/each}}
            </select>
              <button class="btn btn-primary saveButton">Save</button>
                  <form class="searchBox">
                    <input id="{{_id}}search" type="text" value="{{Source_Desc}}" style="width: 350px">
                    <input type="submit" value="New Search">
                </form> 
              <br />
              {{#each resultcodes}}
               {{codeSet}}: {{code}},
              {{/each}}
             
          </td>
	      </tr>
		{{/each}}
    </tbody>
  </table>
  </div>
  </template>
  
  <template name = "buttons">
    <div class='row'>
      <div class="pull-right">
        <form class='ResetDB-button'>
          <input type="submit" class="btn btn-warning" value="Reset DB"/>
        </form>
        <form class='magic-button'>
          <input type="submit" class="btn btn-warning" value="Magic"/>
        </form>
      </div>
    </div>
  </template>

<template name="export">
  <button class="export-data btn btn-success" data-loading-text="Exporting...">Export Data</button>
</template>